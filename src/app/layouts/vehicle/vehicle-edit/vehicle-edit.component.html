<p-breadcrumb [model]="items" [home]="home"></p-breadcrumb>

<div class="card mt-1">
  <div class="card-header">
    <span class="h4">{{ editModeTitle | translate }}</span>
  </div>
  <div class="card-body border-top-primary">
    <form [formGroup]="vehicleForm">
      <p-tabView [activeIndex]="index">
        <!-- Général -->
        <p-tabPanel
          header="{{ 'Général' | translate }}"
          [disabled]="true"
          headerStyleClass="onglet-p-5"
        >
          <div formGroupName="general">
            <!-- Form group imbriqué -->

            <div class="row mt-3 justify-content-around">
              <div class="form-group col-md-3">
                <label class="font-weight-bold"
                  >{{ "Code" | translate }} *</label
                >
                <span
                  *ngIf="
                    (vehicleForm.controls['general'].get('fCode').touched &&
                      vehicleForm.controls['general'].get('fCode').invalid) ||
                    (isFormSubmitted &&
                      vehicleForm.controls['general'].get('fCode').invalid)
                  "
                  class="text-lighter"
                  style="color: red; font-size: xx-small"
                >
                  {{ "Obligatoire" | translate }}
                </span>
                <br />
                <input
                  type="text"
                  class="form-control"
                  pInputText
                  formControlName="fCode"


                />
                <!-- (keydown.space)="$event.preventDefault()" -->
              </div>

              <div class="form-group col-md-3">
                <label class="font-weight-bold"
                  >{{ "Immatriculation" | translate }} *</label
                >
                <span
                  *ngIf="
                    (vehicleForm.controls['general'].get('fRegistrationNumber')
                      .touched &&
                      vehicleForm.controls['general'].get('fRegistrationNumber')
                        .invalid) ||
                    (isFormSubmitted &&
                      vehicleForm.controls['general'].get('fRegistrationNumber')
                        .invalid)
                  "
                  class="text-lighter"
                  style="color: red; font-size: xx-small"
                >
                  {{ "Obligatoire" | translate }}
                </span>
                <br />
                <input
                  type="text"
                  class="form-control"
                  pInputText
                  formControlName="fRegistrationNumber"
                />
              </div>

              <div class="form-group col-md-3">
                <label class="font-weight-bold"
                  >{{ "Catégorie de véhicule " | translate }} *</label
                >
                <span
                  *ngIf="
                    (vehicleForm.controls['general'].get('fVehicleCategory')
                      .touched &&
                      vehicleForm.controls['general'].get('fVehicleCategory')
                        .invalid) ||
                    (isFormSubmitted &&
                      vehicleForm.controls['general'].get('fVehicleCategory')
                        .invalid)
                  "
                  class="text-lighter"
                  style="color: red; font-size: xx-small"
                >
                  {{ "Obligatoire" | translate }}
                </span>
                <p-dropdown
                  [autoDisplayFirst]="false"
                  [options]="vehicleCategoryList"
                  optionLabel="code"
                  formControlName="fVehicleCategory"
                  (onChange)="onSelectVehicleCategory($event)"
                  [filter]="true"
                  [showClear]="true"
                ></p-dropdown>
              </div>
            </div>

            <div class="row justify-content-around">
              <div class="form-group col-md-3">
                <label class="font-weight-bold"
                  >{{ "Type badge " | translate }} *</label
                >
                <span
                  *ngIf="
                    (vehicleForm.controls['general'].get('fBadgeType')
                      .touched &&
                      vehicleForm.controls['general'].get('fBadgeType')
                        .invalid) ||
                    (isFormSubmitted &&
                      vehicleForm.controls['general'].get('fBadgeType').invalid)
                  "
                  class="text-lighter"
                  style="color: red; font-size: xx-small"
                >
                  {{ "Obligatoire" | translate }}
                </span>
                <p-dropdown
                  [autoDisplayFirst]="false"
                  [options]="badgeTypeList"
                  optionLabel="code"
                  formControlName="fBadgeType"
                  (onChange)="onSelectBadgeType($event)"
                  [filter]="true"
                  [showClear]="true"
                ></p-dropdown>
              </div>
              <div class="form-group col-md-3">
                <label class="font-weight-bold">{{
                  "Date du contrôle technique" | translate
                }}</label>
                <br />
                <p-calendar
                  [monthNavigator]="true"
                  [yearNavigator]="true"
                  dateFormat="dd-mm-yy"
                  formControlName="fTechnicalVisit"
                  yearRange="1970:2100"
                ></p-calendar>
              </div>
              <div class="form-group col-md-3">
                <label class="font-weight-bold">{{
                  "Valeur" | translate
                }}</label>
                <br />
                <input
                  type="text"
                  class="form-control"
                  pInputText
                  pKeyFilter="num"
                  formControlName="fValeurVisiteTechnique"
                />
              </div>
            </div>

            <div class="row justify-content-around">
              <div class="form-group col-md-3">
                <label class="font-weight-bold">{{
                  "Date de paiement de vignette" | translate
                }}</label>
                <br />
                <p-calendar
                  [monthNavigator]="true"
                  [yearNavigator]="true"
                  dateFormat="dd-mm-yy"
                  formControlName="fVignette"
                  yearRange="1970:2100"
                ></p-calendar>
              </div>
              <div class="form-group col-md-3">
                <label class="font-weight-bold">{{
                  "Valeur" | translate
                }}</label>
                <br />
                <input
                  type="text"
                  class="form-control"
                  pInputText
                  pKeyFilter="num"
                  formControlName="fValeurVignette"
                />
              </div>
              <div class="form-group col-md-3">
                <label class="font-weight-bold"
                  >{{ "Plan Maintenance " | translate }}
                </label>
                <span
                  *ngIf="
                    (vehicleForm.controls['general'].get('fMaintenancePlan')
                      .touched &&
                      vehicleForm.controls['general'].get('fMaintenancePlan')
                        .invalid) ||
                    (isFormSubmitted &&
                      vehicleForm.controls['general'].get('fMaintenancePlan')
                        .invalid)
                  "
                  class="text-lighter"
                  style="color: red; font-size: xx-small"
                >
                  {{ "Obligatoire" | translate }}
                </span>

                <p-autoComplete
                  formControlName="fMaintenancePlan"
                  [suggestions]="maintenancePlanList"
                  (onSelect)="onSelectMaintenancePlan($event)"
                  (completeMethod)="onMaintenancePlanSearch($event)"
                  field="description"
                >
                </p-autoComplete>
              </div>
            </div>

            <div class="row justify-content-around">
              <div class="form-group col-md-3">
                <label class="font-weight-bold"
                  >{{ "Chauffeur " | translate }}
                </label>
                <span
                  *ngIf="
                    (vehicleForm.controls['general'].get('fDriver').touched &&
                      vehicleForm.controls['general'].get('fDriver').invalid) ||
                    (isFormSubmitted &&
                      vehicleForm.controls['general'].get('fDriver').invalid)
                  "
                  class="text-lighter"
                  style="color: red; font-size: xx-small"
                >
                  {{ "Obligatoire" | translate }}
                </span>

                <p-autoComplete
                  formControlName="fDriver"
                  [suggestions]="driverList"
                  (onSelect)="onSelectDriver($event)"
                  (completeMethod)="onDriverSearch($event)"
                  field="name"
                >
                </p-autoComplete>
              </div>

              <div class="form-group col-md-3">
                <label class="font-weight-bold"
                  >{{ "Mode " | translate }}
                </label>
                <p-selectButton
                  [options]="types"
                  (onOptionClick)="onselectType($event)"
                  optionLabel="name"
                  optionValue="name"
                  formControlName="fFixeOrVariable"
                ></p-selectButton>
              </div>

              <div
                class="form-group col-md-3"
                *ngIf="this.selectedVehicle.fixOrVariable == 'Fixe'"
              >
                <label class="font-weight-bold"
                  >{{ "Date " | translate }}
                </label>
                <p-calendar
                  [monthNavigator]="true"
                  [yearNavigator]="true"
                  dateFormat="dd-mm-yy"
                  formControlName="fDateDriver"
                  yearRange="1970:2100"
                ></p-calendar>
              </div>

              <div
                class="form-group col-md-3"
                *ngIf="this.selectedVehicle.fixOrVariable != 'Fixe'"
              ></div>
            </div>
          </div>

          <!--
        <div class="card m-5 ">
          <div class="card-header" style="background-color: #f7f7f7;">
           <div class="row">

            <div class="col-xs-4 col-md-4 pull-left">
              <button

                type="button"
                class="btn btn-sm btn-primary mx-1"
                (click)="onShowDialogVehicleProduct(vehicleProduct,false)"
                >
                <i class="fa fa-plus"></i>
              </button>
            </div>
            <div class=" col-xs-4 col-md-6 pull-center">
              <span style="font-size: 16px; color: #5f5b5b;">
                <b> {{ "Liste des pieces de rechange" | translate }}</b></span
              >
            </div>
          </div></div>
          <div class="card-body border-top-primary">

            <p-table
            [value]=" this.selectedVehicle?.vehicleProducts" [lazy]="true" [rows]="size" [paginator]="true"
            [totalRecords]=" this.selectedVehicle?.vehicleProducts?.length">
              <ng-template pTemplate="header">
                <tr>
                  <th>{{ "Produit" | translate }}</th>
                  <th>{{ "Référence" | translate }}</th>
                  <th style="width: 15%;">{{ "Actions" | translate }}</th>
                </tr>
              </ng-template>
              <ng-template pTemplate="body" let-line>
                <tr>
                  <td>
                    {{ line?.product?.code }}
                </td>
                <td>{{ line?.reference }}</td>

                  <td>
                    <button

                    type="button"
                    class="btn btn-sm btn-primary mx-1"
                    (click)="onShowDialogVehicleProduct(line,true)"
                    >
                    <i class="fa fa-pencil"></i>
                  </button>
                  <button

                  type="button"
                  class="btn btn-sm btn-danger mx-1"
                  (click)="onDeleteVehicleDriver(line.id)"
                  >
                  <i class="fa fa-trash"></i>
                </button>

                  </td>
                </tr>
              </ng-template>

            </p-table>
          </div>
        </div> -->
        </p-tabPanel>

        <p-tabPanel
          header="{{ 'Piéce de rechange ' | translate }}"
          [disabled]="true"
          headerStyleClass="onglet-p-5 "
        >
          <div class="card mt-5 mb-5" style="border:none !important">
            <div class="card-header" style="background-color: #f7f7f7;    border-radius: 15px;">
              <div class="row">
                <div class="col-xs-4 col-md-4 pull-left">
                  <button
                    type="button"
                    class="btn btn-sm btn-primary mx-1"
                    (click)="onShowDialogVehicleProduct(vehicleProduct, false)"
                  >
                    <!--ADD-->
                    <i class="fa fa-plus"></i>
                  </button>
                </div>
                <div class="col-xs-4 col-md-6 pull-center">
                  <span style="font-size: 16px; color: #5f5b5b">
                    <b>
                      {{ "Liste des pieces de rechange" | translate }}</b
                    ></span
                  >
                </div>
              </div>
            </div>
            <div class="card-body ">

              <div class="row justify-content-around">
                <div class="form-group col-md-6" *ngFor="let parent of this.productTypeParentList">
                 <span  class="onglet-product-type-parent">
                  <p-panel

                    [toggleable]="true"
                    [collapsed]="true"


                  >
                  <ng-template pTemplate="header" >
                   <h6 ><b >{{ parent.productType?.productType?.code }}</b> </h6>
                </ng-template>


                <ng-template pTemplate="content" class="contentproductChild" >
                    <span class="onglet-product-type-children" *ngFor="let child of onSelectProductTypeParent(parent)" >
                      <p-panel (click)="onSelectProductTypeCild(child)"
                        [toggleable]="true"
                        [collapsed]="true"
                      >
                      <ng-template pTemplate="header" >
                        <h6 ><b >{{ child.productType?.code }}</b> </h6>
                     </ng-template>
                     <ng-template pTemplate="icons">
                      <button

                      type="button"
                      class="p-panel-header-icon p-link"
                      (click)="onShowDialogVehicleProduct(child,true)"
                      >
                      <i class="fa fa-pencil"></i>
                    </button>
                    <button

                    type="button"
                    class="p-panel-header-icon p-link"
                    (click)="onDeleteVehicleProduct(child.id)"
                    >
                    <i class="fa fa-trash"></i>
                  </button>
                  </ng-template>

                  <ng-template pTemplate="content">
<div >
  <div class="row  justify-content-around" >

      <div class="form-group col-md-4"*ngFor="let item of onSelectProductTypeCild(child)">
    <!-- <p-button label="{{item?.reference}}"  styleClass=" p-button-sm"></p-button> -->
    <button
    type="button"
    class="btn btn-secondary m-1" style="width: 100%;border: none !important;"
  >
  {{item?.reference}}
  </button>
</div>

    <!-- <button pButton pRipple type="button" label="{{item?.reference}}" class="p-button-outlined p-button-secondary"></button> -->

  </div>
</div>
                    </ng-template>

                      </p-panel>
                    </span>
                  </ng-template>

                  </p-panel>
                </span>
                  </div>
                  </div>



            </div>
          </div>
        </p-tabPanel>

        <!--                     FIn Général                               -->
        <!--                     caractéristiques                           -->
        <p-tabPanel
          header="{{ 'Caractéristiques ' | translate }}"
          [disabled]="true"
          headerStyleClass="onglet-p-5"
        >
          <div formGroupName="caracteristic">
            <!-- Form group imbriqué -->

            <div class="row justify-content-around">
              <div class="form-group col-md-3">
                <label class="font-weight-bold">{{
                  "Carte grise" | translate
                }}</label>

                <br />
                <input
                  type="text"
                  class="form-control"
                  pInputText
                  formControlName="fGrayCard"
                  (keydown.space)="$event.preventDefault()"
                />
              </div>

              <div class="form-group col-md-3">
                <label class="font-weight-bold">{{
                  "Numéro chassis" | translate
                }}</label>

                <br />
                <input
                  type="text"
                  class="form-control"
                  pInputText
                  formControlName="fChassisNumber"
                />
              </div>
              <div class="form-group col-md-3">
                <label class="font-weight-bold">{{
                  "Nombre de cylindres" | translate
                }}</label>
                <br />
                <input
                  type="text"
                  class="form-control"
                  pInputText
                  pKeyFilter="num"
                  formControlName="fNumberCylinder"
                />
              </div>
            </div>

            <div class="row mt-3 justify-content-around">
              <div class="form-group col-md-3">
                <label class="font-weight-bold">{{
                  "Puissance fiscal" | translate
                }}</label>

                <br />
                <input
                  type="text"
                  class="form-control"
                  pInputText
                  pKeyFilter="num"
                  formControlName="fFiscalPower"
                  (keydown.space)="$event.preventDefault()"
                />
              </div>

              <div class="form-group col-md-3">
                <label class="font-weight-bold">{{
                  "Carrosserie" | translate
                }}</label>

                <br />
                <input
                  type="text"
                  class="form-control"
                  pInputText
                  formControlName="fBody"
                />
              </div>
              <div class="form-group col-md-3">
                <label class="font-weight-bold"
                  >{{ "Type de consommation" | translate }} *</label
                >
                <span
                  *ngIf="
                    (vehicleForm.controls['caracteristic'].get(
                      'fConsumptionType'
                    ).touched &&
                      vehicleForm.controls['caracteristic'].get(
                        'fConsumptionType'
                      ).invalid) ||
                    (isFormSubmitted &&
                      vehicleForm.controls['caracteristic'].get(
                        'fConsumptionType'
                      ).invalid)
                  "
                  class="text-lighter"
                  style="color: red; font-size: xx-small"
                >
                  {{ "Obligatoire" | translate }}
                </span>
                <p-dropdown
                  [autoDisplayFirst]="false"
                  [options]="consumptionTypeList"
                  optionLabel="description"
                  formControlName="fConsumptionType"
                  (onChange)="onSelectConsumptionType($event)"
                  [filter]="true"
                  [showClear]="true"
                ></p-dropdown>
              </div>
            </div>
            <hr class="w-50" />

            <div class="row justify-content-around">
              <div class="form-group col-md-3">
                <label class="font-weight-bold"
                  >{{ "Huile moteur" | translate }} (KM)</label
                >

                <br />
                <input
                  type="text"
                  class="form-control"
                  pInputText
                  pKeyFilter="num"
                  formControlName="fEngineOil"
                  (keydown.space)="$event.preventDefault()"
                />
              </div>

              <div class="form-group col-md-3">
                <label class="font-weight-bold"
                  >{{ "Pont arriére" | translate }} (KM)</label
                >

                <br />
                <input
                  type="text"
                  class="form-control"
                  pInputText
                  pKeyFilter="num"
                  formControlName="fRearDeck"
                />
              </div>
              <div class="form-group col-md-3">
                <label class="font-weight-bold"
                  >{{ "Direction " | translate }} (KM)</label
                >
                <br />
                <input
                  type="text"
                  class="form-control"
                  pInputText
                  pKeyFilter="num"
                  formControlName="fDirection"
                />
              </div>
            </div>

            <div class="row justify-content-around">
              <div class="form-group col-md-3">
                <label class="font-weight-bold"
                  >{{ "Filtre à air " | translate }} (KM)</label
                >
                <br />
                <input
                  type="text"
                  class="form-control"
                  pInputText
                  pKeyFilter="num"
                  formControlName="fAreaFilter"
                />
              </div>
              <div class="form-group col-md-3">
                <label class="font-weight-bold"
                  >{{ "Boite à Vitesse " | translate }} (KM)</label
                >
                <br />
                <input
                  type="text"
                  class="form-control"
                  pInputText
                  pKeyFilter="num"
                  formControlName="fGearBox"
                />
              </div>
              <div class="form-group col-md-3">
                <label class="font-weight-bold"
                  >{{ "Filtre dissicateur" | translate }} (KM)</label
                >

                <br />
                <input
                  type="text"
                  class="form-control"
                  pInputText
                  pKeyFilter="num"
                  formControlName="fDesiccantFilter"
                  (keydown.space)="$event.preventDefault()"
                />
              </div>
            </div>

            <div class="row justify-content-around">
              <div class="form-group col-md-3">
                <label class="font-weight-bold"
                  >{{ " Initiale (KM) " | translate }} *</label
                >
                <span
                  *ngIf="
                    (vehicleForm.controls['caracteristic'].get(
                      'fInitialmileage'
                    ).touched &&
                      vehicleForm.controls['caracteristic'].get(
                        'fInitialmileage'
                      ).invalid) ||
                    (isFormSubmitted &&
                      vehicleForm.controls['caracteristic'].get(
                        'fInitialmileage'
                      ).invalid)
                  "
                  class="text-lighter"
                  style="color: red; font-size: xx-small"
                >
                  {{ "Obligatoire" | translate }}
                </span>
                <input
                  type="text"
                  class="form-control"
                  pInputText
                  formControlName="fInitialmileage"
                />
              </div>

              <div class="form-group col-md-3">
                <label class="font-weight-bold"
                  >{{ " Actuel (KM)" | translate }}
                </label>

                <input
                  type="text"
                  class="form-control"
                  [attr.disabled]="true"
                  pInputText
                  formControlName="fCurrentmileage"
                />
              </div>
              <div class="form-group col-md-3"></div>
            </div>
          </div>
        </p-tabPanel>

        <!--                  Fin Onglet  caractéristiques                            -->

        <!--                  début Onglet  Assurance                                       -->
        <p-tabPanel
          header="{{ 'Assurance' | translate }}"
          [disabled]="true"
          headerStyleClass="onglet-p-5"
        >
          <div formGroupName="insurance">
            <div [style.visibility]="editModee ? 'visible' : 'hidden'">
              <button
                type="button"
                class="btn btn-success m-1 float-right"
                (click)="onNvclick()"
              >
                {{ "Nouvelle assurance" | translate }}
              </button>
            </div>
            <br /><br />
            <div class="row mt-3 justify-content-around">
              <div class="form-group col-md-3">
                <label class="font-weight-bold"
                  >{{ "Numero" | translate }}
                </label>
                <!-- <span *ngIf="(vehicleForm.controls['insurance'].get('fICode').touched && vehicleForm.controls['insurance'].get('fICode').invalid) ||
                  (isFormSubmitted && vehicleForm.controls['insurance'].get('fICode').invalid)" class="text-lighter"
                style="color: red; font-size: xx-small;">
                {{"Obligatoire"| translate }}
              </span> -->
                <br />
                <input
                  type="text"
                  class="form-control"
                  pInputText
                  formControlName="fICode"
                  (keydown.space)="$event.preventDefault()"
                />
              </div>

              <div class="form-group col-md-3">
                <label class="font-weight-bold">{{
                  "Type assurance" | translate
                }}</label>
                <!-- <span *ngIf="(vehicleForm.controls['insurance'].get('fIType').touched && vehicleForm.controls['insurance'].get('fIType').invalid) ||
                  (isFormSubmitted && vehicleForm.controls['insurance'].get('fIType').invalid)" class="text-lighter"
                style="color: red; font-size: xx-small;">
                {{"Obligatoire"| translate }}
              </span><br /> -->
                <p-dropdown
                  [options]="insuranceTypeList"
                  optionLabel="description"
                  formControlName="fIType"
                  (onChange)="onSelectInsuranceType($event)"
                  [filter]="true"
                  [showClear]="true"
                >
                </p-dropdown>
              </div>

              <div class="form-group col-md-3">
                <label class="font-weight-bold"
                  >{{ "Fournisseur" | translate }}
                </label>
                <!-- <span *ngIf="(vehicleForm.controls['insurance'].get('fISupplier').touched && vehicleForm.controls['insurance'].get('fISupplier').invalid) ||
                      (isFormSubmitted && vehicleForm.controls['insurance'].get('fISupplier').invalid)" class="text-lighter"
                style="color: red; font-size: xx-small;">
                 {{"Obligatoire"| translate }}
              </span> -->
                <p-dropdown
                  [autoDisplayFirst]="false"
                  [options]="supplierList"
                  optionLabel="contact.name"
                  formControlName="fISupplier"
                  (onChange)="onSelectsupplier($event)"
                  [filter]="true"
                  [showClear]="true"
                >
                </p-dropdown>
              </div>
            </div>
            <div class="row justify-content-around">
              <div class="form-group col-md-3">
                <label class="font-weight-bold">{{ "De" | translate }} </label>
                <!-- <span *ngIf="(vehicleForm.controls['insurance'].get('fIStartDate').touched && vehicleForm.controls['insurance'].get('fIStartDate').invalid) ||
                    (isFormSubmitted && vehicleForm.controls['insurance'].get('fIStartDate').invalid)" class="text-lighter"
                style="color: red; font-size: xx-small;">
                 {{"Obligatoire"| translate }}
              </span> -->
                <br />
                <p-calendar
                  formControlName="fIStartDate"
                  dateFormat="dd-mm-yy"
                  [monthNavigator]="true"
                  [yearNavigator]="true"
                  yearRange="1970:2100"
                ></p-calendar>
              </div>

              <div class="form-group col-md-3">
                <label class="font-weight-bold">{{ "à" | translate }} </label>
                <!-- <span *ngIf="(vehicleForm.controls['insurance'].get('fIEndDate').touched && vehicleForm.controls['insurance'].get('fIEndDate').invalid) ||
                    (isFormSubmitted && vehicleForm.controls['insurance'].get('fIEndDate').invalid)" class="text-lighter"
                style="color: red; font-size: xx-small;">
                {{"Obligatoire"| translate }}
              </span> -->
                <br />
                <p-calendar
                  formControlName="fIEndDate"
                  dateFormat="dd-mm-yy"
                  [monthNavigator]="true"
                  [yearNavigator]="true"
                  yearRange="1970:2100"
                  [locale]="fr"
                ></p-calendar>
              </div>
              <div class="form-group col-md-3">
                <label class="font-weight-bold"
                  >{{ "Montant" | translate }}
                </label>
                <span
                  *ngIf="
                    (vehicleForm.controls['insurance'].get('fIMontant')
                      .touched &&
                      vehicleForm.controls['insurance'].get('fIMontant')
                        .invalid) ||
                    (isFormSubmitted &&
                      vehicleForm.controls['insurance'].get('fIMontant')
                        .invalid)
                  "
                  class="text-lighter"
                  style="color: red; font-size: xx-small"
                >
                  {{ "Obligatoire" | translate }}
                </span>
                <input
                  type="text"
                  class="form-control"
                  pInputText
                  formControlName="fIMontant"
                />
              </div>
            </div>

            <div class="card mt-2">
              <div class="card-header" style="background-color: #f7f7f7">
                <div class="row">
                  <div class="col-xs-4 col-md-4 pull-left">
                    <app-vehicule-edit-line
                      [editMode]="false"
                      (insuranceTermLineAdded)="onLineEdited($event)"
                    ></app-vehicule-edit-line>
                  </div>
                  <div class="col-xs-4 col-md-6 pull-center">
                    {{ "Liste des termes assurance" | translate }}
                  </div>
                </div>
              </div>
              <div class="card-body border-top-primary">
                <!-- selectedInsurance?.insuranceTermLignes -->
                <p-table
                  [value]="this.selectedInsurance?.insuranceTermLignes"
                  [rows]="5"
                  [paginator]="true"
                  [totalRecords]="
                    this.selectedInsurance?.insuranceTermLignes?.length
                  "
                >
                  <ng-template pTemplate="header">
                    <tr>
                      <th>{{ "Terme d'assurance" | translate }}</th>
                      <th>{{ "Montant" | translate }}</th>

                      <th style="width: 10%">{{ "Action" | translate }}</th>
                    </tr>
                  </ng-template>
                  <ng-template pTemplate="body" let-line>
                    <tr>
                      <td>{{ line?.insuranceTerm?.code }}</td>
                      <td>{{ line?.amount }}</td>
                      <td>
                        <app-vehicule-edit-line
                          [selectedTermLigne]="line"
                          [editMode]="true"
                          (insuranceTermLineAdded)="onLineEdited($event)"
                        ></app-vehicule-edit-line>
                        <button
                          type="button"
                          (click)="onDeleteLine(line)"
                          class="btn btn-sm btn-danger mx-1"
                        >
                          <i class="fa fa-trash-o"></i>
                        </button>
                      </td>
                    </tr>
                  </ng-template>
                </p-table>
              </div>
            </div>
          </div>
        </p-tabPanel>
        <!--                  Fin Onglet Assurance       -->

        <!--                  Début Onglet Contrat       -->
        <p-tabPanel
          header="{{ 'Contrat' | translate }}"
          [disabled]="true"
          headerStyleClass="onglet-p-5"
        >
          <div formGroupName="contract">
            <div class="row mt-3 justify-content-around">
              <div class="form-group col-md-3">
                <label class="font-weight-bold"
                  >{{ "Type de contrat" | translate }} *</label
                >
                <span
                  *ngIf="
                    (vehicleForm.controls['contract'].get('fContractType')
                      .touched &&
                      vehicleForm.controls['contract'].get('fContractType')
                        .invalid) ||
                    (isFormSubmitted &&
                      vehicleForm.controls['contract'].get('fContractType')
                        .invalid)
                  "
                  class="text-lighter"
                  style="color: red; font-size: xx-small"
                >
                  {{ "Obligatoire" | translate }} </span
                ><br />
                <p-dropdown
                  [autoDisplayFirst]="false"
                  [options]="contractTypeList"
                  optionLabel="description"
                  [filter]="true"
                  (onChange)="onSelectContract($event)"
                  formControlName="fContractType"
                  [showClear]="true"
                ></p-dropdown>
              </div>
              <div class="form-group col-md-3">
                <label class="font-weight-bold"
                  >{{ "Date aquisition" | translate }} *</label
                >
                <span
                  *ngIf="
                    (vehicleForm.controls['contract'].get('fAquisition')
                      .touched &&
                      vehicleForm.controls['contract'].get('fAquisition')
                        .invalid) ||
                    (isFormSubmitted &&
                      vehicleForm.controls['contract'].get('fAquisition')
                        .invalid)
                  "
                  class="text-lighter"
                  style="color: red; font-size: xx-small"
                >
                  {{ "Obligatoire" | translate }}
                </span>
                <br />
                <p-calendar
                  formControlName="fAquisition"
                  dateFormat="dd-mm-yy"
                  [monthNavigator]="true"
                  [yearNavigator]="true"
                  yearRange="1970:2100"
                ></p-calendar>
              </div>
              <div class="form-group col-md-3">
                <label class="font-weight-bold"
                  >{{ "Mantant" | translate }} *</label
                >
                <span
                  *ngIf="
                    (vehicleForm.controls['contract'].get('fAmountc').touched &&
                      vehicleForm.controls['contract'].get('fAmountc')
                        .invalid) ||
                    (isFormSubmitted &&
                      vehicleForm.controls['contract'].get('fAmountc').invalid)
                  "
                  class="text-lighter"
                  style="color: red; font-size: xx-small"
                >
                  {{ "Obligatoire" | translate }}
                </span>
                <input
                  type="text"
                  class="form-control"
                  pInputText
                  formControlName="fAmountc"
                />

                <br />
              </div>
            </div>
            <div class="row mt-3 justify-content-around">
              <div class="form-group col-md-3">
                <label class="font-weight-bold"
                  >{{ "Durée en mois" | translate }}
                </label>

                <br />
                <input
                  type="text"
                  class="form-control"
                  pInputText
                  formControlName="fDurationInMonth"
                />
              </div>

              <div class="form-group col-md-3">
                <label class="font-weight-bold"
                  >{{ "Mode " | translate }}
                </label>
                <p-selectButton
                  [options]="interneExternes"
                  (onOptionClick)="onselectInterneExterne($event)"
                  formControlName="fInternOrExterne"
                ></p-selectButton>
              </div>

              <div class="form-group col-md-3">
                <span
                  *ngIf="this.selectedVehicle.interneOrExterne == 'Externe'"
                >
                  <label class="font-weight-bold"
                    >{{ "Transport" | translate }}
                  </label>
                  <!-- <span *ngIf="(vehicleForm.controls['contract'].get('fTransport').touched && vehicleForm.controls['contract'].get('fTransport').invalid) ||
                  (isFormSubmitted && vehicleForm.controls['contract'].get('fTransport').invalid)" class="text-lighter"
              style="color: red; font-size: xx-small;">
             {{"Obligatoire"| translate }}
            </span> -->
                  <p-dropdown
                    [autoDisplayFirst]="false"
                    [options]="transportList"
                    optionLabel="name"
                    [filter]="true"
                    (onChange)="onSelectTransport($event)"
                    formControlName="fTransport"
                    [showClear]="true"
                  ></p-dropdown>
                </span>
                <br />
              </div>
            </div>

            <div class="row mt-3 justify-content-around">
              <div class="form-group col-md-3">
                <label class="font-weight-bold"
                  >{{ "Date mise en circulation" | translate }} *</label
                >
                <span
                  *ngIf="
                    (vehicleForm.controls['contract'].get('fRelease').touched &&
                      vehicleForm.controls['contract'].get('fRelease')
                        .invalid) ||
                    (isFormSubmitted &&
                      vehicleForm.controls['contract'].get('fRelease').invalid)
                  "
                  class="text-lighter"
                  style="color: red; font-size: xx-small"
                >
                  {{ "Obligatoire" | translate }}
                </span>
                <br />
                <p-calendar
                  formControlName="fRelease"
                  dateFormat="dd-mm-yy"
                  [monthNavigator]="true"
                  [yearNavigator]="true"
                  yearRange="1970:2100"
                ></p-calendar>
              </div>

              <div class="form-group col-md-3">
                <label class="font-weight-bold"
                  >{{ "Age" | translate }} *</label
                >
                <span
                  *ngIf="
                    (vehicleForm.controls['contract'].get('fRelease').touched &&
                      vehicleForm.controls['contract'].get('fRelease')
                        .invalid) ||
                    (isFormSubmitted &&
                      vehicleForm.controls['contract'].get('fRelease').invalid)
                  "
                  class="text-lighter"
                  style="color: red; font-size: xx-small"
                >
                  {{ "Obligatoire" | translate }}
                </span>
                <br />
                <input
                  type="text"
                  class="form-control"
                  pInputText
                  formControlName="fAge"
                />
              </div>
              <div class="form-group col-md-3"></div>
            </div>

            <div class="text-center mt-3 mr-3 ml-3">
              <a
                class="btn btn-primary m-1"
                [routerLink]="['/core/vehicles/list']"
              >
                {{ "Fermer" | translate }}
              </a>
              <button
                type="button"
                class="btn btn-success m-1"
                (click)="onSubmit()"
              >
                {{ "Valider et continuer" | translate }}
              </button>
              <button
                type="button"
                class="btn btn-success m-1"
                (click)="onSubmit(true)"
              >
                {{ "Valider" | translate }}
              </button>
            </div>
          </div>
        </p-tabPanel>

        <!--             FIn Onglet  Contrat -->

        <div *ngIf="!(this.index == 0)" class="row pull-left">
          <button
            type="button"
            pButton
            icon="fa fa-chevron-left"
            (click)="openPrev()"
          ></button>
        </div>

        <div *ngIf="!(this.index == 4)" class="row pull-right">
          <button
            type="button"
            pButton
            icon="fa fa-chevron-right"
            (click)="openNext()"
          ></button>
        </div>
        <br /><br />
      </p-tabView>
    </form>
  </div>
</div>

<p-toast position="top-right" [autoZIndex]="'true'"></p-toast>
<ngx-spinner
  bdColor="rgba(255,255,255,0)"
  size="large"
  color="#00d2ff"
  type="ball-spin-fade-rotating"
></ngx-spinner>
<p-confirmDialog
  header="Confirmation"
  icon="pi pi-exclamation-triangle"
></p-confirmDialog>

<div *ngIf="showDialogVehiclePriduct == true">
  <app-vehicle-product
    (showDialog)="onHideDialogVehicleProduct($event)"
    (vehicleProductAdded)="onLineEditedVehicleProduct($event)"
    [selectedVehicleProduct]="selectedVehicleProduct"
    [editMode]="editModeVehiclePriduct"
  ></app-vehicle-product>
</div>

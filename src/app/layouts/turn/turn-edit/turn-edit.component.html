<div class="card mt-3">
  <div class="card-header " style="background-color:#f7f7f7;">
    Inserer Turn
  </div>
  <div class="card-body border-top-primary">
    <form>
      <p-steps [model]="items" [(activeIndex)]="activeIndex"> </p-steps>

      <div *ngIf="activeIndex == 0">
        <div class="card">
          <div class="card-header " style="background-color:#f7f7f7;">Filters</div>
          <div class="card-body border-top-primary">
            <div class="row">
              <div class="col-md-3">
                <label class="font-weight-bold ">Code</label><br />
                <input type="text" pInputText [(ngModel)]="codeSearch" [ngModelOptions]="{standalone: true}" />
              </div>

              <!-- <div class="col-md-3">
                <label class="font-weight-bold ">Client</label><br />
                <p-dropdown
          [options]="accountList"
          optionLabel="code"
          [autoDisplayFirst]="false"
          [(ngModel)]="accountSearch"
          [ngModelOptions]="{standalone: true}"
        >
        </p-dropdown>
              </div> -->

            </div>
            <br />

            <div class="text-center">
              <button type="button" class="btn btn-primary mr-2" (click)="reset()">Renitialiser</button>

              <button type="button" class="btn btn-success" (click)="onSearchClicked()">
                Rechercher
              </button>
            </div>
          </div>
        </div>


        <p-pickList
          [source]="saleOrders"
          [target]="saleOrdersLoading"
          sourceHeader="Commande"
          targetHeader="sélectionné"
          [responsive]="true"
          filterBy="account.name,code,expectedDate,deliveryAddress.city"
          dragdrop="true"
          sourceFilterPlaceholder="Recherche Par Client - Commande - Ville"
          targetFilterPlaceholder="Recherche Par Client - Commande - Ville "
          [sourceStyle]="{ height: '300px' }"
          [targetStyle]="{ height: '300px' }"
        >
          <ng-template let-turn pTemplate="item">
            <div class="ui-helper-clearfix">
              <div style="font-size:14px;float:right;margin:15px 5px 0 0">
                Commande :{{ turn.code }} {{ turn.id }} - CLient : {{ turn?.account?.name }} -
                Ville : {{ turn?.deliveryAddress?.city }} date prévue:
                {{ turn?.expectedDate | date: "dd-MM-yyyy" }}
              </div>
            </div>
          </ng-template>
        </p-pickList>



        <div class="row">
          <div class="col-7"></div>
          <div class="col-5">   <h2>
            Totale :
            <small class="text-muted">{{this.totalQnt}}</small>
        </h2></div>
        </div>

      </div>

      <div *ngIf="activeIndex == 1">
        <p-table [value]="saleOrdersLoading">
          <ng-template pTemplate="header">
            <tr>
              <th>Commande</th>
              <th>Client</th>
              <th>Surcharge</th>
              <th>Statut</th>
              <th>Action</th>
            </tr>
          </ng-template>
          <ng-template pTemplate="body" let-del>
            <tr>
              <td>{{ del.code }}-{{ del.id }}</td>
              <td>{{ del.account.code }}</td>
              <td>{{ TotalQnt(del) }}</td>
              <td>{{ del.orderStatus.code }}</td>
              <td>
                <app-delivery-line-edit
                  [editMode]="true"
                  [selectedSaleOrder]="del"
                ></app-delivery-line-edit>
              </td>
            </tr>
          </ng-template>
          <ng-template pTemplate="footer">
            <tr>
              <td colspan="2">Totale</td>
              <td>{{ this.totalQnt }}</td>
            </tr>
          </ng-template>
        </p-table>


      </div>

      <div *ngIf="activeIndex == 2">
        <form [formGroup]="turnForm">
          <div class=" mt-3 row  justify-content-around">
            <div class="form-group col-md-3">
              <label class="font-weight-bold "
                >{{ "Date De la tournée" | translate }} *</label
              >
              <span
              *ngIf="
                (turnForm.get('fDateLivraison').touched &&
                turnForm.get('fDateLivraison').invalid) ||
                (isFormSubmitted && turnForm.get('fDateLivraison').invalid)
              "
              class="text-lighter"
              style="color: red; font-size: xx-small;"
            >
               obligatoire
            </span>
              <p-calendar
                [monthNavigator]="true"
                [yearNavigator]="true"
                dateFormat="dd/mm/yy"
                yearRange="1970:2100"
                formControlName="fDateLivraison"
              >
              </p-calendar>
            </div>
            <div class="form-group col-md-3"></div>
            <div class="form-group col-md-3"></div>
          </div>

          <div class=" mt-3 row  justify-content-around">
            <div class="form-group col-md-3">
              <label class="font-weight-bold "
                >{{ "Type de Véhicule" | translate }} *</label
              >
              <span
              *ngIf="
                (turnForm.get('fTypeVehicule').touched &&
                turnForm.get('fTypeVehicule').invalid) ||
                (isFormSubmitted && turnForm.get('fTypeVehicule').invalid)
              "
              class="text-lighter"
              style="color: red; font-size: xx-small;"
            >
               obligatoire
            </span>
              <p-dropdown
                [autoDisplayFirst]="false"
                (onChange)="onSelectChangeCatVehicle($event)"
                [options]="vehicleCatList"
                optionLabel="code"
                [filter]="true"
                formControlName="fTypeVehicule"
                [filter]="true"
              ></p-dropdown>
            </div>

            <div class="form-group col-md-3">
              <label class="font-weight-bold "
                >{{ "Transport" | translate }} *</label
              >
              <span
              *ngIf="
                (turnForm.get('fTransport').touched &&
                turnForm.get('fTransport').invalid) ||
                (isFormSubmitted && turnForm.get('fTransport').invalid)
              "
              class="text-lighter"
              style="color: red; font-size: xx-small;"
            >
               obligatoire
            </span>
              <p-dropdown
                [autoDisplayFirst]="false"
                [options]="transportList"
                optionLabel="code"
                [filter]="true"
                formControlName="fTransport"
              >
              </p-dropdown>
            </div>

            <div class="form-inline col-md-3 ">
              <label class="font-weight-bold "
                >{{ " Vehicule " | translate }} *</label
              >
              <span
              *ngIf="
                (turnForm.get('fVehicule').touched &&
                turnForm.get('fVehicule').invalid) ||
                (isFormSubmitted && turnForm.get('fVehicule').invalid)
              "
              class="text-lighter"
              style="color: red; font-size: xx-small;"
            >
               obligatoire
            </span><br />
              <p-dropdown
                [autoDisplayFirst]="false"
                [options]="vehicleList"
                optionLabel="code"
                [filter]="true"
                formControlName="fVehicule"
              >
              </p-dropdown>

              <!-- <p-multiSelect
          [options]="cars"
          class="multiselectcss"
          optionLabel="value"

          [maxSelectedLabels]="5"
          [panelStyle]="{ minWidth: '13em' }"
          ></p-multiSelect> -->
            </div>
          </div>
          <div class=" mt-3 row  justify-content-around">
            <div class="form-group col-md-3 ">
              <label class="font-weight-bold "
                >{{ " Chauffeurs " | translate }} *</label
              > <span
              *ngIf="
                (turnForm.get('fDrivers').touched &&
                turnForm.get('fDrivers').invalid) ||
                (isFormSubmitted && turnForm.get('fDrivers').invalid)
              "
              class="text-lighter"
              style="color: red; font-size: xx-small;"
            >
               obligatoire
            </span>
              <br />

              <p-multiSelect
                [options]="driverList"
                optionLabel="name"
                defaultLabel="- - - - - - Choisir - - - - - - "
                [maxSelectedLabels]="5"
                [panelStyle]="{ minWidth: '20em' }"
                [showTransitionOptions]="'0ms'"
                [hideTransitionOptions]="'0ms'"
                formControlName="fDrivers"
              >
              </p-multiSelect>
            </div>

            <div class="form-group col-md-3 "></div>

            <div class="form-group col-md-3 "></div>
          </div>
        </form>

        <div class="text-center mt-3 mr-3 ml-3">
          <a class="btn btn-primary m-1" [routerLink]="['/core/vehicles/list']">
            {{ "Fermer" | translate }}
          </a>
          <button
            type="button"
            class="btn btn-success m-1"
            (click)="onSubmit()"
          >
            {{ "Valider et continuer" | translate }}
          </button>
        </div>
      </div>
    </form>

    <div *ngIf="!(this.activeIndex == 0)" class="row pull-left ">
      <button
        type="button"
        pButton
        icon="fa fa-chevron-left"
        (click)="previous()"
      ></button>
    </div>

    <div *ngIf="!(this.activeIndex == 2)" class="row pull-right">
      <button
        type="button"
        pButton
        icon="fa fa-chevron-right"
        (click)="next()"
      ></button>
    </div>
  </div>
</div>
<div class="alert alert-danger" *ngIf="this.catVehiculeQnt">
  <strong>Error!</strong>le Poids Total: {{ this.totalQnt }}
  Poids total autorisé en charge : {{ this.totalqntV }}
</div>

<ngx-spinner bdColor="rgba(255,255,255,0)" size="large" color="#00d2ff" type="ball-spin-fade-rotating"></ngx-spinner>

<br />
<div class="card">
  <div class="card-header " style="background-color:#f7f7f7;">
    Inserer Turn
  </div>
  <div class="card-body border-top-primary">
    <form>
      <p-steps [model]="items" [(activeIndex)]="activeIndex">
      </p-steps>

      <div *ngIf="activeIndex == 0">
        <p-pickList [source]="deliveries" [target]="delivriesLoading" sourceHeader="livraison" targetHeader="sélectionné"
          [responsive]="true" filterBy="code" dragdrop="true" sourceFilterPlaceholder="recherche"
          targetFilterPlaceholder="recherche " [sourceStyle]="{ height: '300px' }"
          [targetStyle]="{ height: '300px' }">
          <ng-template let-turn pTemplate="item">
            <div class="ui-helper-clearfix">
              <div style="font-size:14px;float:right;margin:15px 5px 0 0">
                Livraison :{{ turn.code }} - CLient :
                {{ turn?.account?.code }} - Ville :
                {{ turn?.deliveryAddress?.city }}
              </div>
            </div>
          </ng-template>
        </p-pickList>
      </div>

      <div *ngIf="activeIndex == 1">
        <p-table [value]="delivriesLoading">
          <ng-template pTemplate="header">
            <tr>
              <th>Livraison</th>
              <th>Client</th>
              <th>TotalQuantite</th>
              <th>Action</th>
            </tr>
          </ng-template>
          <ng-template pTemplate="body" let-del>
            <tr>
              <td>{{ del.code }}</td>
              <td>{{ del.account.code }}</td>
              <td>{{ TotalQnt(del) }}</td>
              <td>

                <app-delivery-line-edit [editMode]="true" [selectedDelivery]="del"></app-delivery-line-edit>

              </td>
            </tr>
          </ng-template>
        </p-table>
      </div>

      <div *ngIf="activeIndex == 2">

        <form [formGroup]="turnForm">
          <div class=" mt-3 row  justify-content-around">
            <div class="form-group col-md-3">
              <label class="font-weight-bold ">{{ "Date De la tournée" | translate }} *</label>
              <p-calendar [monthNavigator]="true" [yearNavigator]="true" dateFormat="dd/mm/yy" yearRange="1970:2100"
              formControlName="fDateLivraison">
              </p-calendar>
            </div>
            <div class="form-group col-md-3"></div>
            <div class="form-group col-md-3"></div>
          </div>

          <div class=" mt-3 row  justify-content-around">
            <div class="form-group col-md-3">
              <label class="font-weight-bold ">{{ "Type de Véhicule" | translate }} *</label>
              <p-dropdown [autoDisplayFirst]="false"
              (onChange)="onSelectChangeCatVehicle($event)" [options]="vehicleCatList" optionLabel="code" [filter]="true"
              formControlName="fTypeVehicule"
                [filter]="true" ></p-dropdown>
            </div>

            <div class="form-group col-md-3">
              <label class="font-weight-bold ">{{ "Transport" | translate }} *</label>
              <p-dropdown [autoDisplayFirst]="false" [options]="transportList" optionLabel="code" [filter]="true"
              formControlName="fTransport">
              </p-dropdown>
            </div>

            <div class="form-inline col-md-3 ">
              <label class="font-weight-bold ">{{ " Vehicule " | translate }} *</label><br />
              <p-dropdown [autoDisplayFirst]="false" [options]="vehicleList" optionLabel="code" [filter]="true"
              formControlName="fVehicule">
              </p-dropdown>

              <!-- <p-multiSelect
          [options]="cars"
          class="multiselectcss"
          optionLabel="value"

          [maxSelectedLabels]="5"
          [panelStyle]="{ minWidth: '13em' }"
          ></p-multiSelect> -->
            </div>
          </div>
          <div class=" mt-3 row  justify-content-around">
            <div class="form-group col-md-3 ">
              <label class="font-weight-bold ">{{ " Chauffeurs " | translate }} *</label><br />

              <p-multiSelect [options]="driverList" optionLabel="name" defaultLabel="- - - - - - Choisir - - - - - - " [maxSelectedLabels]="5"
                [panelStyle]="{ minWidth: '20em' }"
                 [showTransitionOptions]="'0ms'" [hideTransitionOptions]="'0ms'"
                 formControlName="fDrivers">
              </p-multiSelect>
            </div>

            <div class="form-group col-md-3 "></div>

            <div class="form-group col-md-3 "></div>
          </div>
        </form>

        <div class="text-center mt-3 mr-3 ml-3">
          <a class="btn btn-primary m-1" [routerLink]="['/core/vehicles/list']">
            {{'Fermer' | translate}}
          </a>
          <button type="button" class="btn btn-success m-1" (click)="onSubmit()">
            {{'Valider et continuer' | translate }}
          </button>

        </div>
      </div>
    </form>

    <div *ngIf="!(this.activeIndex == 0)" class="row pull-left ">
      <button type="button" pButton icon="fa fa-chevron-left" (click)="previous()"></button>
    </div>

    <div *ngIf="!(this.activeIndex == 2)" class="row pull-right">
      <button type="button" pButton icon="fa fa-chevron-right" (click)="next()"></button>
    </div>
  </div>
</div>
<div class="alert alert-danger"  *ngIf="this.catVehiculeQnt" >
  <strong>Error!</strong>Quantite {{this.totalQnt}} superieur {{this.totalqntV}}
</div>

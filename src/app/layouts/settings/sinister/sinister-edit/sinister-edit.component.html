<div class="card mt-4">
  <div class="card-header">
    <span class="h4">{{ this.title | translate }}</span>
  </div>
  <div class="card-body border-top-primary">
    <form [formGroup]="sinisterForm">
      <div class="row justify-content-around">

        <div class="form-group col-md-3 ">
          <label class="font-weight-bold ">{{'Code' | translate}} *</label>
          <span *ngIf="(sinisterForm.get('fcode').touched && sinisterForm.get('fcode').invalid) ||
            (isFormSubmitted && sinisterForm.get('fcode').invalid)" class="text-lighter"
            style="color: red; font-size: xx-small;">
            {{'Obligatoire' |translate }}
          </span>
          <br />
          <input type="text" class="form-control" pInputText formControlName="fcode"
            (keydown.space)="$event.preventDefault()"  />
        </div>

        <div class="form-group col-md-9 ">
          <label class="font-weight-bold ">{{'Description' | translate}} *</label>
          <span *ngIf="(sinisterForm.get('fdesc').touched && sinisterForm.get('fdesc').invalid) ||
            (isFormSubmitted && sinisterForm.get('fdesc').invalid)" class="text-lighter"
            style="color: red; font-size: xx-small;">
            {{'Obligatoire' |translate }}
          </span>
          <br />
          <input type="text" class="form-control" pInputText formControlName="fdesc"
            (keydown.space)="$event.preventDefault()"  />
        </div>





      </div>

      <div class="row justify-content-around">
        <div class="form-group col-md-3 ">
          <label class="font-weight-bold ">{{'Type Sinistre' | translate}} *</label>
          <span *ngIf="(sinisterForm.get('fsinisterType').touched && sinisterForm.get('fsinisterType').invalid) ||
            (isFormSubmitted && sinisterForm.get('fsinisterType').invalid)" class="text-lighter"
            style="color: red; font-size: xx-small;">
            {{'Obligatoire' |translate }}
          </span>
          <br />
          <p-dropdown [autoDisplayFirst]="false" [options]="sinisterTypeList" optionLabel="code" placeholder="{{this.selectedSinister?.sinisterType?.code}}"
          formControlName="fsinisterType" (onChange)="onSelectSinisterType($event)" [filter]="true"
           [showClear]="true"></p-dropdown>
        </div>
        <div class="form-group col-md-3 ">
          <label class="font-weight-bold ">{{'VÃ©hicule' | translate}} *</label>
          <span *ngIf="(sinisterForm.get('fvehicle').touched && sinisterForm.get('fvehicle').invalid) ||
            (isFormSubmitted && sinisterForm.get('fvehicle').invalid)" class="text-lighter"
            style="color: red; font-size: xx-small;">
            {{'Obligatoire' |translate }}
          </span>
          <br />
          <p-autoComplete  formControlName="fvehicle" [suggestions]="vehicleList"
          (onSelect)="onSelectVehicle($event)" (completeMethod)="onVehicleCodeSearch($event)" field="registrationNumber">
        </p-autoComplete>
        </div>

        <div class="form-group col-md-3 ">
          <label class="font-weight-bold ">{{'Chauffeur' | translate}} *</label>
          <span *ngIf="(sinisterForm.get('fdriver').touched && sinisterForm.get('fdriver').invalid) ||
            (isFormSubmitted && sinisterForm.get('fdriver').invalid)" class="text-lighter"
            style="color: red; font-size: xx-small;">
            {{'Obligatoire' |translate }}
          </span>
          <br />
          <p-autoComplete  formControlName="fdriver" [suggestions]="driverList"
          (onSelect)="onSelectDriver($event)" (completeMethod)="onDriverNameSearch($event)" field="name">
        </p-autoComplete>
        </div>


        <div class="form-group col-md-3 ">
          <label class="font-weight-bold ">{{'Assureur' | translate}} *</label>
          <span *ngIf="(sinisterForm.get('fsupplier').touched && sinisterForm.get('fsupplier').invalid) ||
            (isFormSubmitted && sinisterForm.get('fsupplier').invalid)" class="text-lighter"
            style="color: red; font-size: xx-small;">
            {{'Obligatoire' |translate }}
          </span>
          <br />
          <p-autoComplete  formControlName="fsupplier" [suggestions]="supplierList"
          (onSelect)="onSelectSupplier($event)" (completeMethod)="onSupplierNameSearch($event)" field="contact.name">
        </p-autoComplete>
        </div>


      </div>

      <div class="row justify-content-around">

        <div class="form-group col-md-3 ">
          <label class="font-weight-bold ">{{'Lieu ' | translate}} *</label>
          <span *ngIf="(sinisterForm.get('fvenue').touched && sinisterForm.get('fvenue').invalid) ||
            (isFormSubmitted && sinisterForm.get('fvenue').invalid)" class="text-lighter"
            style="color: red; font-size: xx-small;">
            {{'Obligatoire' |translate }}
          </span>
          <br />
          <input type="text" class="form-control" pInputText formControlName="fvenue"
          (keydown.space)="$event.preventDefault()"  />
        </div>
        <div class="form-group col-md-3 ">
          <label class="font-weight-bold ">{{'Date ' | translate}} *</label>
          <span *ngIf="(sinisterForm.get('fdate').touched && sinisterForm.get('fdate').invalid) ||
            (isFormSubmitted && sinisterForm.get('fdate').invalid)" class="text-lighter"
            style="color: red; font-size: xx-small;">
            {{'Obligatoire' |translate }}
          </span>
          <br />
          <p-calendar [monthNavigator]="true" [yearNavigator]="true" dateFormat="dd-mm-yy"
          formControlName="fdate" yearRange="1970:2100"></p-calendar>

        </div>

        <div class="form-group col-md-3 ">
          <label class="font-weight-bold ">{{'remboursement (DH)' | translate}} *</label>
          <span *ngIf="(sinisterForm.get('frepayment').touched && sinisterForm.get('frepayment').invalid) ||
            (isFormSubmitted && sinisterForm.get('frepayment').invalid)" class="text-lighter"
            style="color: red; font-size: xx-small;">
            {{'Obligatoire' |translate }}
          </span>
          <br />
          <input type="text" class="form-control" pInputText formControlName="frepayment"
          (keydown.space)="$event.preventDefault()"  />
        </div>
        <div class="form-group col-md-3 ">
</div>
      </div>
    </form>


    <div class="card  ">
      <div class="card-header" style="background-color: #f7f7f7;">
        <div class="row">

          <div class="col-xs-4 col-md-4 pull-left">
            <button type="button" class="btn btn-sm btn-primary mx-1" (click)="onShowDialogDocument(this.selectedDocument,false)">
              <i class="fa fa-plus"></i>
            </button>
          </div>
          <div class=" col-xs-4 col-md-6 pull-center">
            <span style="font-size: 16px; color: #5f5b5b;">
              <b> {{ "Liste des Documents" | translate }}</b></span>
          </div>
        </div>
      </div>
      <div class="card-body border-top-primary">
        <p-table [value]=" this.selectedSinister?.documents" [lazy]="true" [rows]="5"
          [paginator]="true" [totalRecords]=" this.selectedSinister
      ?.documents?.length">
          <ng-template pTemplate="header">
            <tr>


              <th>{{'code' | translate}}</th>
              <th>{{'Description' | translate}}</th>
              <th>{{'Type Document' | translate}}</th>

              <th>{{'Ficher' | translate}}</th>
              <th>{{'Date'| translate}}</th>

              <th style="width: 18%;">{{ "Actions" | translate }}</th>

            </tr>
          </ng-template>
          <ng-template pTemplate="body" let-line>
            <tr>
              <td>{{line?.code}}</td>
              <td>{{line?.description}}</td>
              <td>{{line?.documentType?.code}}</td>
              <td>{{line?.fileName}}</td>
              <td>{{line?.date }}</td>

              <td>

                <button  type="button" class="btn btn-sm btn-primary mx-1"
                  (click)="onShowDialogDocument(line,true)">
                  <!--ADD-->
                  <i class="fa fa-pencil"></i>
                </button>
                <button  type="button" class="btn btn-sm btn-danger mx-1"
                  (click)="onDeleteDocument(line.id)">
                  <!--ADD-->
                  <i class="fa fa-trash"></i>
                </button>
              </td>
            </tr>
          </ng-template>

        </p-table>
      </div>
    </div>
  </div>



<div class="text-center mt-3 mr-3 ml-3" >

  <div class="text-center mt-3 mr-3 ml-3" >
    <a class="btn btn-primary m-1" [routerLink]="['/core/account']">
      {{'Fermer' | translate}}
    </a>
    <button type="button" class="btn btn-success m-1" (click)="onSubmit()">
      {{'Valider et continuer' | translate }}
    </button>
    <button type="button" class="btn btn-success m-1" (click)="onSubmit(true)">
      {{ "Valider" | translate }}
    </button>
  </div>
</div>

</div>


<div *ngIf="showDialogDocument == true">
  <app-sinister-document-edit
  (showDialog)="onHideDialogDocument($event)"
  (documentEdited)="onLineEditedDocuemnt($event)"
    [selectedDocument]="selectedDocument"

  [editMode]="editModeDocument"
  ></app-sinister-document-edit>


</div>

<p-confirmDialog
  header="Confirmation"
  icon="pi pi-exclamation-triangle"
  [acceptLabel]="'Oui'"
  [rejectLabel]="'Non'"
>
</p-confirmDialog>
